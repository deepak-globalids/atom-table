<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../vaadin-grid/vaadin-grid.html">
<link rel="import" href="../vaadin-grid/vaadin-grid-sorter.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">

<!--
`atom-table`

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--atom-table-cell` | Mixin applied to all atom table cells | `{}`
`--atom-table-header-cell` | Mixin applied to atom table header cells | `{}`
`--atom-table-body-cell` | Mixin applied to atom table body cells | `{}`

@demo demo/index.html 
-->

<dom-module id="atom-table">
  <template>
    <style>
       :host {
        display: block;

        --vaadin-grid-cell: {
          @apply(--atom-table-cell);
        }
        --vaadin-grid-body-cell: {
          background-color: #fcfdff;
          @apply(--atom-table-body-cell);
        }
        --vaadin-grid-header-cell: {
          @apply(--atom-table-header-cell);
        }
      }

       :host .actions {
        @apply(--layout);
        @apply(--layout-end-justified);
      }
    </style>
    <div class="actions">
      <template is="dom-if" if="{{allowGlobalSearch}}">
        <paper-icon-button class="global-search" icon="icons:search"></paper-icon-button>
      </template>
      <template is="dom-if" if="{{allowAddNew}}">
        <paper-icon-button class="add-new" icon="icons:add"></paper-icon-button>
      </template>
    </div>
    <vaadin-grid items="{{items}}">
      <template is="dom-repeat" items="{{columns}}" as="column">
        <vaadin-grid-column>
          <template class="header">
            [[column.name]]
          </template>
          <!--<template>
            [[_getPropertyValue(item, column.property)]]
          </template>-->
        </vaadin-grid-column>
      </template>
    </vaadin-grid>
  </template>

  <script>
    Polymer({

      is: 'atom-table',

      properties: {
        allowFilters: {
          type: Boolean,
          value: false
        },
        allowPaging: {
          type: Boolean,
          value: false
        },
        allowAddNew: {
          type: Boolean,
          value: false
        },
        allowGlobalSearch: {
          type: Boolean,
          value: false
        },
        columns: {
          type: Array,
          value: []
        },
        items: {
          type: Array,
          value: []
        }
      },

      behaviors: [Polymer.Templatizer],

      attached: function () {
        this._renderRows();
      },

      _renderRows: function () {
        var that = this;
        var grid = Polymer.dom(this.$$('vaadin-grid'));
        var templates = this.queryAllEffectiveChildren('atom-table-column')
          .map(function (e) {
            return e.querySelector('template');
          });

        this.items.forEach(function (item) {

          templates.forEach(function (template, index) {
            var clone = that.stamp({});
            var property = that.columns[index].property;
            var value = item[property];

            clone['item'] = value;
          });

        });


        this.dataHost = this;
      },

      _getPropertyValue: function (item, prop) {
        return item ? item[prop] : '';
      },

    });
  </script>
</dom-module>